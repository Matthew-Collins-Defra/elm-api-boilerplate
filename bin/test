#!/usr/bin/env sh

# Environment variable defaults
test "${CONTAINER_IMAGE}" = "" && CONTAINER_IMAGE="elm-lmp-api:local"
test "${OUTPUT_DIR}" = "" && OUTPUT_DIR="test-output"

# Ensure output directory exists and is writable from containers
outputDirectory="$(pwd)/${OUTPUT_DIR}/"
test -d "${outputDirectory}" || mkdir "${outputDirectory}"
chmod 777 "${outputDirectory}"

# Unit tests
docker run --rm -v "$(pwd)/${OUTPUT_DIR}/:/home/node/${OUTPUT_DIR}/" ${CONTAINER_IMAGE}-development npm run test
result=$?
test ${result} != 0 && echo "Unit test failed. Exiting." && exit ${result}
